<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title> â€¢ Posts by &#34;çŸ¥è¯†&#34; category</title>
        <link>http://example.com</link>
        <description>æ¬¢è¿æ¥åˆ°Huançš„ç¬”è®°ç©ºé—´~~~~~~ğŸŒ¸</description>
        <language>zh-CN</language>
        <pubDate>Wed, 09 Aug 2023 10:57:17 +0800</pubDate>
        <lastBuildDate>Wed, 09 Aug 2023 10:57:17 +0800</lastBuildDate>
        <category>wp</category>
        <category>é¶æœºæ¸—é€</category>
        <category>vulnHUB</category>
        <category>canary</category>
        <category>csu</category>
        <category>rop</category>
        <category>gdb</category>
        <category>å †</category>
        <category>pie</category>
        <category>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</category>
        <category>æ ¼å¼åŒ–å­—ç¬¦ä¸²</category>
        <category>gotè¡¨</category>
        <category>srop</category>
        <category>uaf</category>
        <category>unlink</category>
        <category>gotæ”¹å†™</category>
        <category>éšæœºæ•°æ£€æŸ¥</category>
        <item>
            <guid isPermalink="true">http://example.com/2023/08/09/bins/</guid>
            <title>bins</title>
            <link>http://example.com/2023/08/09/bins/</link>
            <category>å †</category>
            <pubDate>Wed, 09 Aug 2023 10:57:17 +0800</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;pwnå †-binså­¦ä¹ &#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#pwnå †-binså­¦ä¹ &#34;&gt;#&lt;/a&gt; pwn å † bins å­¦ä¹ ã€‚&lt;/h1&gt;
&lt;h2 id=&#34;ä¸€-biné“¾çš„ä»‹ç»&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸€-biné“¾çš„ä»‹ç»&#34;&gt;#&lt;/a&gt; ä¸€ã€bin é“¾çš„ä»‹ç»&lt;/h2&gt;
&lt;p&gt;bin æ˜¯ä¸€ä¸ªç”± struct chunk ç»“æ„ä½“ç»„æˆçš„é“¾è¡¨ã€‚&lt;br&gt;
å‰é¢ä»‹ç»è¿‡ï¼Œä¸åŒçš„ chunk æ ¹æ®ç‰¹ç‚¹ä¸åŒåˆ†ä¸ºä¸åŒçš„ chunkï¼Œä¸ºäº†å°†è¿™äº› chunk è¿›è¡Œåˆ†ç±»çš„ç®¡ç†ï¼Œglibc é‡‡ç”¨äº† bin é“¾è¿™ç§æ–¹å¼ç®¡ç†ä¸åŒçš„ chunkã€‚&lt;br&gt;
ä¸åŒçš„ bin é“¾æ˜¯ç”± arena ç®¡ç†çš„ã€‚&lt;br&gt;
bin é“¾ä¸­çš„ chunk å‡ä¸º free chunkã€‚&lt;/p&gt;
&lt;h2 id=&#34;äºŒ-biné“¾åˆ†ç±»&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äºŒ-biné“¾åˆ†ç±»&#34;&gt;#&lt;/a&gt; äºŒã€bin é“¾åˆ†ç±»&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ ¹æ® bin é“¾æˆå‘˜çš„å¤§å°ä¸åŒï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š
&lt;ul&gt;
&lt;li&gt;fast bin æ˜¯å•é“¾è¡¨ï¼Œå…¶ä»–éƒ½æ˜¯åŒå‘é“¾è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fast binã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Unsorted binã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Small binã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Large binã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸‰-biné“¾çš„ä¿å­˜struct-malloc_stateç»“æ„ä½“&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸‰-biné“¾çš„ä¿å­˜struct-malloc_stateç»“æ„ä½“&#34;&gt;#&lt;/a&gt; ä¸‰ã€bin é“¾çš„ä¿å­˜ï¼ˆstruct malloc_state ç»“æ„ä½“ï¼‰&lt;/h2&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;span&gt;c&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;malloc_chunk&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; mchunkptr&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;malloc_chunk&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;mfastbinptr&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;malloc_state&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token comment&#34;&gt;/*other member*/&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token comment&#34;&gt;/* Fastbins */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  mfastbinptr fastbinsY&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;NFASTBINS&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token comment&#34;&gt;/* Normal bins packed as described above */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  mchunkptr bins&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;NBINS &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token comment&#34;&gt;/*other member*/&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;blockquote&gt;
&lt;p&gt;å‰é¢è¯´è¿‡ï¼Œä¸åŒçš„ bin é“¾æ˜¯ç”± arena ç®¡ç†çš„ã€‚å› æ­¤ä¸€ä¸ªçº¿ç¨‹ä¸­ä¼šæœ‰å¾ˆå¤šçš„ bin é“¾ï¼Œè¿™äº› bin é“¾éƒ½æœ‰ arena æ‰€è¡¨ç¤ºçš„ struct malloc_state ç»“æ„ä½“çš„ä»¥ä¸‹æˆå‘˜ä¿å­˜ï¼š&lt;br&gt;
fastbinY æ•°ç»„ï¼šå¤§å°ä¸º 10ã€‚è®°å½•çš„æ˜¯ fast bin é“¾ã€‚&lt;br&gt;
bins æ•°ç»„ï¼šå¤§å°ä¸º 129ã€‚è®°å½•çš„æ˜¯ unsorted binï¼ˆ1ï¼‰ã€small binï¼ˆ2~63ï¼‰ã€large bin é“¾ï¼ˆ64~126ï¼‰ã€‚&lt;br&gt;
&lt;img data-src=&#34;/img/bins/4.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å››-fast-bin&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å››-fast-bin&#34;&gt;#&lt;/a&gt; å››ã€Fast Bin&lt;/h2&gt;
&lt;p&gt;æ¦‚å¿µï¼šchunk çš„å¤§å°åœ¨ 32 å­—èŠ‚ â€”â€”128 å­—èŠ‚ï¼ˆ0x20â€”â€”0x80ï¼‰çš„ chunk ç§°ä¸º â€œfast chunkâ€ï¼ˆå¤§å°ä¸æ˜¯ malloc æ—¶çš„å¤§å°ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­ struct malloc_chunk çš„å¤§å°ï¼ŒåŒ…å«å‰ 2 ä¸ªæˆå‘˜ï¼‰ã€‚&lt;br&gt;
fast bin é“¾è¡¨çš„ä¸ªæ•°ä¸º 10 ä¸ªã€‚&lt;br&gt;
ä¸ä¼šå¯¹ free chunk è¿›è¡Œåˆå¹¶ï¼šé‰´äºè®¾è®¡ fast bin çš„åˆè¡·å°±æ˜¯è¿›è¡Œå¿«é€Ÿçš„å°å†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œå› æ­¤ç³»ç»Ÿå°†å±äº fast bin çš„ chunk çš„ PREV_INUSE ä½æ€»æ˜¯è®¾ç½®ä¸º 1ï¼Œè¿™æ ·å³ä½¿å½“ fast bin ä¸­æœ‰æŸä¸ª chunk åŒä¸€ä¸ª free chunk ç›¸é‚»çš„æ—¶å€™ï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šè¿›è¡Œè‡ªåŠ¨åˆå¹¶æ“ä½œï¼Œè€Œæ˜¯ä¿ç•™ä¸¤è€…ã€‚è™½ç„¶è¿™æ ·åšå¯èƒ½ä¼šé€ æˆé¢å¤–çš„ç¢ç‰‡åŒ–é—®é¢˜ï¼Œä½†ç‘•ä¸æ©ç‘œã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;fastbinsY æ•°ç»„å­˜å‚¨ fastbins çš„è§„åˆ™&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸ª fast bin é“¾è¡¨éƒ½æ˜¯å•é“¾è¡¨ï¼ˆä½¿ç”¨ fd æŒ‡é’ˆï¼‰ã€‚å› æ­¤ï¼Œfast bin ä¸­æ— è®ºæ˜¯æ·»åŠ è¿˜æ˜¯ç§»é™¤ fast chunkï¼Œéƒ½æ˜¯å¯¹ â€œé“¾è¡¨å°¾â€ è¿›è¡Œæ“ä½œï¼Œè€Œä¸ä¼šå¯¹æŸä¸ªä¸­é—´çš„ fast chunk è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å•ä¸ª fastbin é“¾è¡¨ä¸­çš„ chunk å¤§å°éƒ½æ˜¯ç›¸åŒçš„ï¼Œå„ä¸ª fastbin é“¾è¡¨ä¸­çš„ chunk å¤§å°æ˜¯ä¸åŒçš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;fastbinY æ•°ç»„ä¸­çš„æ¯ä¸ª bin é“¾è¡¨çš„æ’åºï¼Œæ˜¯æŒ‰ç…§é“¾è¡¨å…ƒç´ çš„å¤§å°è¿›è¡Œæ’åºçš„ã€‚æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ fast bin é“¾è¡¨ä¸­çš„æ¯ä¸ª chunk çš„å¤§å°æ˜¯ 32 å­—èŠ‚çš„ï¼Œæ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ çš„ fast bin é“¾è¡¨ä¸­çš„æ¯ä¸ª chunk çš„å¤§å°æ˜¯ 48 å­—èŠ‚çš„â€¦ æ¯ä¸ªå…ƒç´ éƒ½æ¯”å‰é¢çš„ fast bin é“¾å¤§ 16 å­—èŠ‚ï¼Œä»¥æ­¤ç±»æ¨è¿›è¡Œæ’åºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/img/bins/1.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;é“¾è¡¨ç´¢å¼•å®å®šä¹‰ï¼šï¼ˆfastbin_indexï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;** åŠŸèƒ½ï¼š** é€šè¿‡æ­¤å®èƒ½åˆ¤æ–­æŸä¸€ä¸ª fastchunk å±äºå“ªä¸€ä¸ª fastbin é“¾è¡¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;** å‚æ•°ï¼š** æŸä¸€ä¸ª chunk çš„å¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/img/bins/20190730083911707.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;malloc æ“ä½œä¸ fastbins çš„åˆå§‹åŒ–ï¼š&lt;br&gt;
å½“åº”ç”¨å±‚é€šè¿‡ malloc å‡½æ•°ç¬¬ä¸€æ¬¡ç”³è¯·çš„ chunk å±äº 16 å­—èŠ‚ï½80 å­—èŠ‚ä¹‹é—´æ—¶ï¼Œå› ä¸ºåˆå§‹åŒ–çš„æ—¶å€™ fast bin æ”¯æŒçš„æœ€å¤§å†…å­˜å¤§å°ä»¥åŠæ‰€æœ‰ fast bin é“¾è¡¨éƒ½æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¸ä¼šäº¤ç”± fast bin æ¥å¤„ç†ï¼Œè€Œæ˜¯å‘ä¸‹ä¼ é€’äº¤ç”± small bin æ¥å¤„ç†ï¼Œå¦‚æœ small bin ä¹Ÿä¸ºç©ºçš„è¯å°±äº¤ç»™ unsorted bin å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;é‚£ä¹ˆï¼Œfast bin å¦‚ä½•è¿›è¡Œåˆå§‹åŒ–å“ªï¼Ÿ&lt;br&gt;
å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨ malloc (fast bin) çš„æ—¶å€™ï¼Œç³»ç»Ÿæ‰§è¡Œ_int_malloc å‡½æ•°ï¼Œè¯¥å‡½æ•°é¦–å…ˆä¼šå‘ç°å½“å‰ fast bin ä¸ºç©ºï¼Œå°±è½¬äº¤ç»™ small bin å¤„ç†ï¼Œè¿›è€Œåˆå‘ç° small bin ä¹Ÿä¸ºç©ºï¼Œå°±è°ƒç”¨ malloc_consolidate å‡½æ•°å¯¹ malloc_state ç»“æ„ä½“è¿›è¡Œåˆå§‹åŒ–ã€‚malloc_consolidate å‡½æ•°ä¸»è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š&lt;br&gt;
a  é¦–å…ˆåˆ¤æ–­å½“å‰ malloc_state ç»“æ„ä½“ä¸­çš„ fast bin æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºå°±è¯´æ˜æ•´ä¸ª malloc_state éƒ½æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ï¼Œéœ€è¦å¯¹ malloc_state è¿›è¡Œåˆå§‹åŒ–ã€‚&lt;br&gt;
b  malloc_state çš„åˆå§‹åŒ–æ“ä½œç”±å‡½æ•° malloc_init_state (av) å®Œæˆï¼Œè¯¥å‡½æ•°å…ˆåˆå§‹åŒ–é™¤ fast bin ä¹‹å¤–çš„æ‰€æœ‰çš„ binsï¼Œå†åˆå§‹åŒ– fast binsã€‚&lt;br&gt;
é‚£ä¹ˆå½“å†æ¬¡æ‰§è¡Œ malloc (fast chunk) å‡½æ•°çš„æ—¶å€™ï¼Œæ­¤æ—¶ fast bin ç›¸å…³æ•°æ®ä¸ä¸ºç©ºäº†ï¼Œå°±å¯ä»¥ä½¿ç”¨ fast binã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;free æ“ä½œ&lt;br&gt;
è¿™ä¸ªæ“ä½œå¾ˆç®€å•ï¼Œä¸»è¦åˆ†ä¸ºä¸¤æ­¥ï¼šå…ˆé€šè¿‡ chunksize å‡½æ•°æ ¹æ®ä¼ å…¥çš„åœ°å€æŒ‡é’ˆè·å–è¯¥æŒ‡é’ˆå¯¹åº”çš„ chunk çš„å¤§å°ï¼›ç„¶åæ ¹æ®è¿™ä¸ª chunk å¤§å°è·å–è¯¥ chunk æ‰€å±çš„ fast binï¼Œç„¶åå†å°†æ­¤ chunk æ·»åŠ åˆ°è¯¥ fast bin çš„é“¾å°¾å³å¯ã€‚æ•´ä¸ªæ“ä½œéƒ½æ˜¯åœ¨_int_free å‡½æ•°ä¸­å®Œæˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;äº”-unsorted-bin&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#äº”-unsorted-bin&#34;&gt;#&lt;/a&gt; äº”ã€Unsorted Bin&lt;/h2&gt;
&lt;p&gt;ä½•æ—¶ä½¿ç”¨ï¼šå½“é‡Šæ”¾è¾ƒå°æˆ–è¾ƒå¤§çš„ chunk çš„æ—¶å€™ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å°†å®ƒä»¬æ·»åŠ åˆ°å¯¹åº”çš„ bins ä¸­ï¼Œç³»ç»Ÿå°±å°†è¿™äº› chunk æ·»åŠ åˆ° unsorted bin ä¸­ã€‚&lt;br&gt;
ç›®çš„ï¼šè¿™ä¸»è¦æ˜¯ä¸ºäº†è®© â€œglibc malloc æœºåˆ¶â€ èƒ½å¤Ÿæœ‰ç¬¬äºŒæ¬¡æœºä¼šé‡æ–°åˆ©ç”¨æœ€è¿‘é‡Šæ”¾çš„ chunk (ç¬¬ä¸€æ¬¡æœºä¼šå°±æ˜¯ fast bin æœºåˆ¶)ã€‚åˆ©ç”¨ unsorted binï¼Œå¯ä»¥åŠ å¿«å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾æ“ä½œï¼Œå› ä¸ºæ•´ä¸ªæ“ä½œéƒ½ä¸å†éœ€è¦èŠ±è´¹é¢å¤–çš„æ—¶é—´å»æŸ¥æ‰¾åˆé€‚çš„ bin äº†ã€‚&lt;br&gt;
Unsorted bin çš„ç‰¹æ€§å¦‚ä¸‹ï¼š&lt;br&gt;
unsorted bin çš„ä¸ªæ•°ï¼š 1 ä¸ªã€‚&lt;br&gt;
unsorted bin æ˜¯ä¸€ä¸ªç”± free chunks ç»„æˆçš„å¾ªç¯åŒé“¾è¡¨ã€‚&lt;br&gt;
åœ¨ unsorted bin ä¸­ï¼Œå¯¹ chunk çš„å¤§å°å¹¶æ²¡æœ‰é™åˆ¶ï¼Œä»»ä½•å¤§å°çš„ chunk éƒ½å¯ä»¥å½’å±åˆ° unsorted bin ä¸­ã€‚&lt;br&gt;
unsortedbin é‡‡ç”¨çš„éå†é¡ºåºæ˜¯ FIFOã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…­-small-bin&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å…­-small-bin&#34;&gt;#&lt;/a&gt; å…­ã€Small Bin&lt;/h2&gt;
&lt;p&gt;æ¦‚å¿µï¼šå°äº 1024 å­—èŠ‚ï¼ˆ0x400ï¼‰çš„ chunk ç§°ä¹‹ä¸º small chunkï¼Œsmall bin å°±æ˜¯ç”¨äºç®¡ç† small chunk çš„ã€‚&lt;br&gt;
small bin é“¾è¡¨çš„ä¸ªæ•°ä¸º 62 ä¸ªã€‚&lt;br&gt;
å°±å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾é€Ÿåº¦è€Œè¨€ï¼Œsmall bin æ¯” larger bin å¿«ï¼Œä½†æ¯” fast bin æ…¢ã€‚&lt;br&gt;
åˆå¹¶æ“ä½œï¼šç›¸é‚»çš„ free chunk éœ€è¦è¿›è¡Œåˆå¹¶æ“ä½œï¼Œå³åˆå¹¶æˆä¸€ä¸ªå¤§çš„ free chunkã€‚å…·ä½“æ“ä½œè§ä¸‹æ–‡ free (small chunk) ä»‹ç»ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Small Bin é“¾è¡¨çš„ç‰¹æ€§&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¯ä¸ª smallbin ä¹Ÿæ˜¯ä¸€ä¸ªç”±å¯¹åº” free chunk ç»„æˆçš„å¾ªç¯åŒé“¾è¡¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;small bin é‡‡ç”¨ FIFO (å…ˆå…¥å…ˆå‡º) ç®—æ³•ï¼šå†…å­˜é‡Šæ”¾æ“ä½œå°±å°†æ–°é‡Šæ”¾çš„ chunk æ·»åŠ åˆ°é“¾è¡¨çš„ front end (å‰ç«¯)ï¼Œåˆ†é…æ“ä½œå°±ä»é“¾è¡¨çš„ rear end (å°¾ç«¯) ä¸­è·å– chunkã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å•ä¸ª smallbin é“¾è¡¨ä¸­çš„ chunk å¤§å°éƒ½æ˜¯ç›¸åŒçš„ï¼Œå„ä¸ª smallbin é“¾è¡¨ä¸­çš„ chunk å¤§å°æ˜¯ä¸åŒçš„ï¼Œè·Ÿ fastbinsY æ•°ç»„å­˜å‚¨ fastbin é“¾çš„åŸç†æ˜¯ç›¸åŒçš„ã€‚&lt;br&gt;
bins æ•°ç»„å­˜å‚¨ small bin é“¾æ—¶ï¼šç¬¬ä¸€ä¸ª small bin é“¾ä¸­ chunk çš„å¤§å°ä¸º 32 å­—èŠ‚ï¼Œåç»­æ¯ä¸ª small bin ä¸­ chunk çš„å¤§å°ä¾æ¬¡å¢åŠ ä¸¤ä¸ªæœºå™¨å­—é•¿ï¼ˆ32 ä½ç›¸å·® 8 å­—èŠ‚ï¼Œ64 ä½ç›¸å·® 16 å­—èŠ‚ï¼‰â€¦ ä»¥æ­¤ç±»æ¨ï¼Œè·Ÿ fastbinsY æ•°ç»„å­˜å‚¨ fastbin é“¾çš„åŸç†æ˜¯ç›¸åŒçš„ï¼ˆç”¨ä¸‹å›¾è¡¨ç¤ºï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;bin é“¾å­˜å‚¨çš„å¤§å°ä¸æ•°ç»„ä¸‹æ ‡çš„å…³ç³»ï¼šchun_size=2&lt;em&gt;SIZE_SZ&lt;/em&gt;indexã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/img/bins/2.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;malloc æ“ä½œä¸ small bin çš„åˆå§‹åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç±»ä¼¼äº fast binsï¼Œæœ€åˆæ‰€æœ‰çš„ small bin éƒ½æ˜¯ç©ºçš„ï¼Œå› æ­¤åœ¨å¯¹è¿™äº› small bin å®Œæˆåˆå§‹åŒ–ä¹‹å‰ï¼Œå³ä½¿ç”¨æˆ·è¯·æ±‚çš„å†…å­˜å¤§å°å±äº small chunk ä¹Ÿä¸ä¼šäº¤ç”± small bin è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯äº¤ç”± unsorted bin å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ unsorted bin ä¹Ÿä¸èƒ½å¤„ç†çš„è¯ï¼Œglibc malloc å°±ä¾æ¬¡éå†åç»­çš„æ‰€æœ‰ binsï¼Œæ‰¾å‡ºç¬¬ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„ binï¼Œå¦‚æœæ‰€æœ‰çš„ bin éƒ½ä¸æ»¡è¶³çš„è¯ï¼Œå°±è½¬è€Œä½¿ç”¨ top chunkï¼Œå¦‚æœ top chunk å¤§å°ä¸å¤Ÿï¼Œé‚£ä¹ˆå°±æ‰©å…… top chunkï¼Œè¿™æ ·å°±ä¸€å®šèƒ½æ»¡è¶³éœ€æ±‚äº†ã€‚&lt;/li&gt;
&lt;li&gt;æ³¨æ„éå†åç»­ bins ä»¥åŠä¹‹åçš„æ“ä½œåŒæ ·è¢« large bin æ‰€ä½¿ç”¨ï¼Œå› æ­¤ï¼Œå°†è¿™éƒ¨åˆ†å†…å®¹æ”¾åˆ° large bin çš„ malloc æ“ä½œä¸­åŠ ä»¥ä»‹ç»ã€‚&lt;/li&gt;
&lt;li&gt;é‚£ä¹ˆ glibc malloc æ˜¯å¦‚ä½•åˆå§‹åŒ–è¿™äº› bins çš„å‘¢ï¼Ÿå› ä¸ºè¿™äº› bin å±äº malloc_state ç»“æ„ä½“ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ– malloc_state çš„æ—¶å€™å°±ä¼šå¯¹è¿™äº› bin è¿›è¡Œåˆå§‹åŒ–ï¼Œä»£ç å¦‚ä¸‹ï¼š
&lt;ul&gt;
&lt;li&gt;å°† bins æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæˆå‘˜ç´¢å¼•å€¼è®¾ç½®ä¸ºäº† 1ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ 0 (åœ¨ bin_at å®ä¸­ï¼Œè‡ªåŠ¨å°† i è¿›è¡Œäº†å‡ 1 å¤„ç†)ã€‚&lt;/li&gt;
&lt;li&gt;ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºåœ¨åˆå§‹åŒ–çš„æ—¶å€™ glibc malloc å°†æ‰€æœ‰ bin çš„æŒ‡é’ˆéƒ½æŒ‡å‘äº†è‡ªå·± â€”â€” è¿™å°±ä»£è¡¨è¿™äº› bin éƒ½æ˜¯ç©ºçš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€‹&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;malloc_init_state&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;mstate av&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;int&lt;/span&gt; i&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    mbinptr bin&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;/* Establish circular links for normal bins */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;i &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; i &lt;span class=&#34;token operator&#34;&gt;&amp;lt;&lt;/span&gt; NBINS&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;++&lt;/span&gt;i&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    bin &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;bin_at&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;av&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; i&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    bin&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;fd &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; bin&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;bk &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; bin&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;ul&gt;
&lt;li&gt;è¿‡åï¼Œå½“å†æ¬¡è°ƒç”¨ malloc (small chunk) çš„æ—¶å€™ï¼Œå¦‚æœè¯¥ chunk size å¯¹åº”çš„ small bin ä¸ä¸ºç©ºï¼Œå°±ä»è¯¥ small bin é“¾è¡¨ä¸­å–å¾— small chunk ç»™ malloc ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;free æ“ä½œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;small çš„ free æ¯”è¾ƒç‰¹æ®Šã€‚å½“é‡Šæ”¾ small chunk çš„æ—¶å€™ï¼Œå…ˆæ£€æŸ¥è¯¥ chunk ç›¸é‚»çš„ chunk æ˜¯å¦ä¸º freeï¼Œå¦‚æœæ˜¯çš„è¯å°±è¿›è¡Œåˆå¹¶æ“ä½œï¼šå°†è¿™äº› chunks åˆå¹¶æˆæ–°çš„ chunkï¼Œç„¶åå°†å®ƒä»¬ä» small bin ä¸­ç§»é™¤ï¼Œæœ€åå°†æ–°çš„ chunk æ·»åŠ åˆ° unsorted bin ä¸­ï¼Œä¹‹å unsorted bin è¿›è¡Œæ•´ç†å†æ·»åŠ åˆ°å¯¹åº”çš„ bin é“¾ä¸Šï¼ˆåé¢ä¼šæœ‰å›¾ä»‹ç»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ä¸ƒ-large-bin&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ä¸ƒ-large-bin&#34;&gt;#&lt;/a&gt; ä¸ƒã€Large Bin&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ¦‚å¿µï¼šå¤§äºç­‰äº 1024 å­—èŠ‚ï¼ˆ0x400ï¼‰çš„ chunk ç§°ä¹‹ä¸º large chunkï¼Œlarge bin å°±æ˜¯ç”¨äºç®¡ç†è¿™äº› largechunk çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;large bin é“¾è¡¨çš„ä¸ªæ•°ä¸º 63 ä¸ªï¼Œè¢«åˆ†ä¸º 6 ç»„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;largechunk ä½¿ç”¨ fd_nextsizeã€bk_nextsize è¿æ¥èµ·æ¥çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆå¹¶æ“ä½œï¼šç±»ä¼¼äº small binã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Large Bin é“¾è¡¨çš„ç‰¹æ€§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŒä¸€ä¸ª largebin ä¸­æ¯ä¸ª chunk çš„å¤§å°å¯ä»¥ä¸ä¸€æ ·ï¼Œè¿™äº› chunk æ ¹æ®ä¸€å®šçš„èŒƒå›´å­˜å‚¨åœ¨ä¸€ä¸ª larbin é“¾è¡¨ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;large chunk å¯ä»¥æ·»åŠ ã€åˆ é™¤åœ¨ large bin çš„ä»»ä½•ä¸€ä¸ªä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è¿™ 63 ä¸ª largebins ä¸­ï¼šç¬¬ä¸€ç»„çš„ 32 ä¸ª largebin é“¾ä¾æ¬¡ä»¥ 64 å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼Œå³ç¬¬ä¸€ä¸ª largebin é“¾ä¸­ chunksize ä¸º 1024-1087 å­—èŠ‚ï¼Œç¬¬äºŒä¸ª large bin ä¸­ chunk size ä¸º 1088~1151 å­—èŠ‚ã€‚ç¬¬äºŒç»„çš„ 16 ä¸ª largebin é“¾ä¾æ¬¡ä»¥ 512 å­—èŠ‚æ­¥é•¿ä¸ºé—´éš”ï¼›ç¬¬ä¸‰ç»„çš„ 8 ä¸ª largebin é“¾ä»¥æ­¥é•¿ 4096 ä¸ºé—´éš”ï¼›ç¬¬å››ç»„çš„ 4 ä¸ª largebin é“¾ä»¥ 32768 å­—èŠ‚ä¸ºé—´éš”ï¼›ç¬¬äº”ç»„çš„ 2 ä¸ª largebin é“¾ä»¥ 262144 å­—èŠ‚ä¸ºé—´éš”ï¼›æœ€åä¸€ç»„çš„ largebin é“¾ä¸­çš„ chunk å¤§å°æ— é™åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img data-src=&#34;/img/bins/3.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨åŒä¸€ä¸ª largebin ä¸­ï¼šæ¯ä¸ª chunk çš„å¤§å°ä¸ä¸€å®šç›¸åŒï¼Œå› æ­¤ä¸ºäº†åŠ å¿«å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„é€Ÿåº¦ï¼Œå°±å°†åŒä¸€ä¸ª largebin ä¸­çš„æ‰€æœ‰ chunk æŒ‰ç…§ chunksize è¿›è¡Œä»å¤§åˆ°å°çš„æ’åˆ—ï¼šæœ€å¤§çš„ chunk æ”¾åœ¨ä¸€ä¸ªé“¾è¡¨çš„ front endï¼Œæœ€å°çš„ chunk æ”¾åœ¨ rear endï¼›ç›¸åŒå¤§å°çš„ chunk æŒ‰ç…§æœ€è¿‘ä½¿ç”¨é¡ºåºæ’åºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&#34;é“¾è¡¨ç´¢å¼•å®å®šä¹‰largebin_index&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#é“¾è¡¨ç´¢å¼•å®å®šä¹‰largebin_index&#34;&gt;#&lt;/a&gt; é“¾è¡¨ç´¢å¼•å®å®šä¹‰ï¼šï¼ˆlargebin_indexï¼‰&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å‚æ•°ä¸ºé“¾è¡¨èƒ½å­˜å‚¨çš„ chunk å¤§å°ï¼Œå®å®šä¹‰ä¸­æœ‰ç®€ä»‹è°ƒç”¨å…¶ä»–å®å®šä¹‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¾‹å¦‚ï¼šç¬¬ä¸€ä¸ª largebin çš„èµ·å§‹å¤§å°ä¸º 1024ï¼Œé‚£ä¹ˆ 1024&amp;gt;&amp;gt;6=16ï¼Œæ‰€ä»¥å…¶åœ¨ bins æ•°ç»„ä¸­çš„ä¸‹æ ‡ä¸º 48+16=64ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/img/bins/5.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;malloc æ“ä½œä¸ large bin çš„åˆå§‹åŒ–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆå§‹åŒ–å®Œæˆä¹‹å‰çš„æ“ä½œç±»ä¼¼äº small binã€‚&lt;/li&gt;
&lt;li&gt;ä¸‹é¢è®¨è®º large bins åˆå§‹åŒ–å®Œæˆä¹‹åçš„æ“ä½œï¼š
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆç¡®å®šç”¨æˆ·è¯·æ±‚çš„å¤§å°å±äºå“ªä¸€ä¸ª large binï¼Œç„¶ååˆ¤æ–­è¯¥ large bin ä¸­æœ€å¤§çš„ chunk çš„ size æ˜¯å¦å¤§äºç”¨æˆ·è¯·æ±‚çš„ size (åªéœ€è¦å¯¹æ¯”é“¾è¡¨ä¸­ front end çš„ size å³å¯)ã€‚å¦‚æœå¤§äºï¼Œå°±ä» rear end å¼€å§‹éå†è¯¥ large binï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª size ç›¸ç­‰æˆ–æ¥è¿‘çš„ chunkï¼Œåˆ†é…ç»™ç”¨æˆ·ã€‚å¦‚æœè¯¥ chunk å¤§äºç”¨æˆ·è¯·æ±‚çš„ size çš„è¯ï¼Œå°±å°†è¯¥ chunk æ‹†åˆ†ä¸ºä¸¤ä¸ª chunkï¼šå‰è€…è¿”å›ç»™ç”¨æˆ·ï¼Œä¸” size ç­‰åŒäºç”¨æˆ·è¯·æ±‚çš„ sizeï¼›å‰©ä½™çš„éƒ¨åˆ†åšä¸ºä¸€ä¸ªæ–°çš„ chunk æ·»åŠ åˆ° unsorted bin ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè¯¥ large bin ä¸­æœ€å¤§çš„ chunk çš„ size å°äºç”¨æˆ·è¯·æ±‚çš„ size çš„è¯ï¼Œé‚£ä¹ˆå°±ä¾æ¬¡æŸ¥çœ‹åç»­çš„ large bin ä¸­æ˜¯å¦æœ‰æ»¡è¶³éœ€æ±‚çš„ chunkï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯é‰´äº bin çš„ä¸ªæ•°è¾ƒå¤š (ä¸åŒ bin ä¸­çš„ chunk ææœ‰å¯èƒ½åœ¨ä¸åŒçš„å†…å­˜é¡µä¸­)ï¼Œå¦‚æœæŒ‰ç…§ä¸Šä¸€æ®µä¸­ä»‹ç»çš„æ–¹æ³•è¿›è¡Œéå†çš„è¯ (å³éå†æ¯ä¸ª bin ä¸­çš„ chunk)ï¼Œå°±å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡å†…å­˜é¡µä¸­æ–­æ“ä½œï¼Œè¿›è€Œä¸¥é‡å½±å“æ£€ç´¢é€Ÿåº¦ï¼Œæ‰€ä»¥ glibc malloc è®¾è®¡äº† Binmap ç»“æ„ä½“æ¥å¸®åŠ©æé«˜ bin-by-bin æ£€ç´¢çš„é€Ÿåº¦ã€‚Binmap è®°å½•äº†å„ä¸ª bin ä¸­æ˜¯å¦ä¸ºç©ºï¼Œé€šè¿‡ bitmap å¯ä»¥é¿å…æ£€ç´¢ä¸€äº›ç©ºçš„ binã€‚å¦‚æœé€šè¿‡ binmap æ‰¾åˆ°äº†ä¸‹ä¸€ä¸ªéç©ºçš„ large bin çš„è¯ï¼Œå°±æŒ‰ç…§ä¸Šä¸€æ®µä¸­çš„æ–¹æ³•åˆ†é… chunkï¼Œå¦åˆ™å°±ä½¿ç”¨ top chunk æ¥åˆ†é…åˆé€‚çš„å†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&#34;freeæ“ä½œ&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#freeæ“ä½œ&#34;&gt;#&lt;/a&gt; free æ“ä½œ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç±»ä¼¼äº small chunkã€‚&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;/img/bins/6.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å…«-tcache&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#å…«-tcache&#34;&gt;#&lt;/a&gt; å…«ã€tcache&lt;/h2&gt;
&lt;p&gt;cache æ˜¯ glibc 2.26 (ubuntu 17.10) ä¹‹åå¼•å…¥çš„ä¸€ç§æŠ€æœ¯ï¼ˆsee &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9zb3VyY2V3YXJlLm9yZy9naXQvP3A9Z2xpYmMuZ2l0O2E9Y29tbWl0ZGlmZjtoPWQ1YzNmYWZjNDMwN2M5YjdhNGM3ZDVjYjM4MWZjZGJmYWQzNDBiY2M=&#34;&gt;commit&lt;/span&gt;ï¼‰ï¼Œç›®çš„æ˜¯æå‡å †ç®¡ç†çš„æ€§èƒ½ã€‚ä½†æå‡æ€§èƒ½çš„åŒæ—¶èˆå¼ƒäº†å¾ˆå¤šå®‰å…¨æ£€æŸ¥ï¼Œä¹Ÿå› æ­¤æœ‰äº†å¾ˆå¤šæ–°çš„åˆ©ç”¨æ–¹å¼ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸»è¦å‚è€ƒäº† glibc æºç ï¼Œangelboy çš„ slide ä»¥åŠ tukan.farmï¼Œé“¾æ¥éƒ½æ”¾åœ¨æœ€åäº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç›¸å…³ç»“æ„ä½“ &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI18x&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;tcache å¼•å…¥äº†ä¸¤ä¸ªæ–°çš„ç»“æ„ä½“ï¼Œ &lt;code&gt;tcache_entry&lt;/code&gt;  å’Œ  &lt;code&gt;tcache_perthread_struct&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å…¶å®å’Œ fastbin å¾ˆåƒï¼Œä½†åˆä¸ä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;tcache_entry&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI3RjYWNoZV9lbnRyeQ==&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jb2RlLndvYm9xLm9yZy91c2Vyc3BhY2UvZ2xpYmMvbWFsbG9jL21hbGxvYy5jLmh0bWwjdGNhY2hlX2VudHJ5&#34;&gt;source code&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;/* We overlay this structure on the user-data portion of a chunk when&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;   the chunk is stored in the per-thread cache.  */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;tcache_entry&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;tcache_entry&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;next&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt; tcache_entry&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;code&gt;tcache_entry&lt;/code&gt;  ç”¨äºé“¾æ¥ç©ºé—²çš„ chunk ç»“æ„ä½“ï¼Œå…¶ä¸­çš„  &lt;code&gt;next&lt;/code&gt;  æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå¤§å°ç›¸åŒçš„ chunkã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ next æŒ‡å‘ chunk çš„ user dataï¼Œè€Œ fastbin çš„ fd æŒ‡å‘ chunk å¼€å¤´çš„åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸”ï¼Œtcache_entry ä¼šå¤ç”¨ç©ºé—² chunk çš„ user data éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;tcache_perthread_struct&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI3RjYWNoZV9wZXJ0aHJlYWRfc3RydWN0&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jb2RlLndvYm9xLm9yZy91c2Vyc3BhY2UvZ2xpYmMvbWFsbG9jL21hbGxvYy5jLmh0bWwjdGNhY2hlX3BlcnRocmVhZF9zdHJ1Y3Q=&#34;&gt;source code&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;/* There is one of these for each thread, which contains the&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;   per-thread cache (hence &#34;tcache_perthread_struct&#34;).  Keeping&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;   overall size low is mildly important.  Note that COUNTS and ENTRIES&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;   are redundant (we could have just counted the linked list each&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;   time), this is for performance reasons.  */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;tcache_perthread_struct&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;char&lt;/span&gt; counts&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;TCACHE_MAX_BINS&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  tcache_entry &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;entries&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;TCACHE_MAX_BINS&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt; tcache_perthread_struct&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token macro property&#34;&gt;&lt;span class=&#34;token directive-hash&#34;&gt;#&lt;/span&gt; &lt;span class=&#34;token directive keyword&#34;&gt;define&lt;/span&gt; &lt;span class=&#34;token macro-name&#34;&gt;TCACHE_MAX_BINS&lt;/span&gt;                &lt;span class=&#34;token expression&#34;&gt;&lt;span class=&#34;token number&#34;&gt;64&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;static&lt;/span&gt; __thread tcache_perthread_struct &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;tcache &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token constant&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;æ¯ä¸ª thread éƒ½ä¼šç»´æŠ¤ä¸€ä¸ª  &lt;code&gt;tcache_perthread_struct&lt;/code&gt; ï¼Œå®ƒæ˜¯æ•´ä¸ª tcache çš„ç®¡ç†ç»“æ„ï¼Œä¸€å…±æœ‰  &lt;code&gt;TCACHE_MAX_BINS&lt;/code&gt;  ä¸ªè®¡æ•°å™¨å’Œ  &lt;code&gt;TCACHE_MAX_BINS&lt;/code&gt;  é¡¹ tcache_entryï¼Œå…¶ä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;tcache_entry&lt;/code&gt;  ç”¨å•å‘é“¾è¡¨çš„æ–¹å¼é“¾æ¥äº†ç›¸åŒå¤§å°çš„å¤„äºç©ºé—²çŠ¶æ€ï¼ˆfree åï¼‰çš„ chunkï¼Œè¿™ä¸€ç‚¹ä¸Šå’Œ fastbin å¾ˆåƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;counts&lt;/code&gt;  è®°å½•äº†  &lt;code&gt;tcache_entry&lt;/code&gt;  é“¾ä¸Šç©ºé—² chunk çš„æ•°ç›®ï¼Œæ¯æ¡é“¾ä¸Šæœ€å¤šå¯ä»¥æœ‰ 7 ä¸ª chunkã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨å›¾è¡¨ç¤ºå¤§æ¦‚æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;åŸºæœ¬å·¥ä½œæ–¹å¼ &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI18y&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡ malloc æ—¶ï¼Œä¼šå…ˆ malloc ä¸€å—å†…å­˜ç”¨æ¥å­˜æ”¾  &lt;code&gt;tcache_perthread_struct&lt;/code&gt;  ã€‚&lt;/li&gt;
&lt;li&gt;free å†…å­˜ï¼Œä¸” size å°äº small bin size æ—¶&lt;/li&gt;
&lt;li&gt;tcache ä¹‹å‰ä¼šæ”¾åˆ° fastbin æˆ–è€… unsorted bin ä¸­&lt;/li&gt;
&lt;li&gt;tcache åï¼š
&lt;ul&gt;
&lt;li&gt;å…ˆæ”¾åˆ°å¯¹åº”çš„ tcache ä¸­ï¼Œç›´åˆ° tcache è¢«å¡«æ»¡ï¼ˆé»˜è®¤æ˜¯ 7 ä¸ªï¼‰&lt;/li&gt;
&lt;li&gt;tcache è¢«å¡«æ»¡ä¹‹åï¼Œå†æ¬¡ free çš„å†…å­˜å’Œä¹‹å‰ä¸€æ ·è¢«æ”¾åˆ° fastbin æˆ–è€… unsorted bin ä¸­&lt;/li&gt;
&lt;li&gt;tcache ä¸­çš„ chunk ä¸ä¼šåˆå¹¶ï¼ˆä¸å–æ¶ˆ inuse bitï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;malloc å†…å­˜ï¼Œä¸” size åœ¨ tcache èŒƒå›´å†…&lt;/li&gt;
&lt;li&gt;å…ˆä» tcache å– chunkï¼Œç›´åˆ° tcache ä¸ºç©º&lt;/li&gt;
&lt;li&gt;tcache ä¸ºç©ºåï¼Œä» bin ä¸­æ‰¾&lt;/li&gt;
&lt;li&gt;tcache ä¸ºç©ºæ—¶ï¼Œå¦‚æœ  &lt;code&gt;fastbin/smallbin/unsorted bin&lt;/code&gt;  ä¸­æœ‰ size ç¬¦åˆçš„ chunkï¼Œä¼šå…ˆæŠŠ  &lt;code&gt;fastbin/smallbin/unsorted bin&lt;/code&gt;  ä¸­çš„ chunk æ”¾åˆ° tcache ä¸­ï¼Œç›´åˆ°å¡«æ»¡ã€‚ä¹‹åå†ä» tcache ä¸­å–ï¼›å› æ­¤ chunk åœ¨ bin ä¸­å’Œ tcache ä¸­çš„é¡ºåºä¼šåè¿‡æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æºç åˆ†æ &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI18z&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä»æºç çš„è§’åº¦åˆ†æä¸€ä¸‹ tcacheã€‚&lt;/p&gt;
&lt;p&gt;libc_malloc&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI19fbGliY19tYWxsb2M=&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡ malloc æ—¶ï¼Œä¼šè¿›å…¥åˆ°  &lt;code&gt;MAYBE_INIT_TCACHE ()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jb2RlLndvYm9xLm9yZy91c2Vyc3BhY2UvZ2xpYmMvbWFsbG9jL21hbGxvYy5jLmh0bWwjMzAxMA==&#34;&gt;source code&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;__libc_malloc&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token class-name&#34;&gt;size_t&lt;/span&gt; bytes&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token macro property&#34;&gt;&lt;span class=&#34;token directive-hash&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;token directive keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token expression&#34;&gt;USE_TCACHE&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token comment&#34;&gt;/* int_free also calls request2size, be careful to not pad twice.  */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token class-name&#34;&gt;size_t&lt;/span&gt; tbytes&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token comment&#34;&gt;// æ ¹æ® malloc ä¼ å…¥çš„å‚æ•°è®¡ç®— chunk å®é™…å¤§å°ï¼Œå¹¶è®¡ç®— tcache å¯¹åº”çš„ä¸‹æ ‡&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token function&#34;&gt;checked_request2size&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;bytes&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; tbytes&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token class-name&#34;&gt;size_t&lt;/span&gt; tc_idx &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;csize2tidx&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tbytes&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token comment&#34;&gt;// åˆå§‹åŒ– tcache&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token function&#34;&gt;MAYBE_INIT_TCACHE&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  DIAG_PUSH_NEEDS_COMMENT&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tc_idx &lt;span class=&#34;token operator&#34;&gt;&amp;lt;&lt;/span&gt; mp_&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tcache_bins  &lt;span class=&#34;token comment&#34;&gt;// æ ¹æ® size å¾—åˆ°çš„ idx åœ¨åˆæ³•çš„èŒƒå›´å†…&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token comment&#34;&gt;/*&amp;amp;&amp;amp; tc_idx &amp;lt; TCACHE_MAX_BINS*/&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;/* to appease gcc */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token operator&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; tcache&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token operator&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;entries&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;token constant&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;//tcache-&gt;entries [tc_idx] æœ‰ chunk&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;tcache_get&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  DIAG_POP_NEEDS_COMMENT&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token macro property&#34;&gt;&lt;span class=&#34;token directive-hash&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;token directive keyword&#34;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;27&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;tcache_init()&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI19fdGNhY2hlX2luaXQ=&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­  &lt;code&gt;MAYBE_INIT_TCACHE ()&lt;/code&gt;  åœ¨ tcache ä¸ºç©ºï¼ˆå³ç¬¬ä¸€æ¬¡ mallocï¼‰æ—¶è°ƒç”¨äº†  &lt;code&gt;tcache_init()&lt;/code&gt; ï¼Œç›´æ¥æŸ¥çœ‹  &lt;code&gt;tcache_init()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jb2RlLndvYm9xLm9yZy91c2Vyc3BhY2UvZ2xpYmMvbWFsbG9jL21hbGxvYy5jLmh0bWwjdGNhY2hlX2luaXQ=&#34;&gt;source code&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;tcache_init&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  mstate ar_ptr&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;victim &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;size_t&lt;/span&gt; bytes &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;sizeof&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache_perthread_struct&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache_shutting_down&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token function&#34;&gt;arena_get&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ar_ptr&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bytes&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;// æ‰¾åˆ°å¯ç”¨çš„ arena&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  victim &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;_int_malloc&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ar_ptr&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bytes&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;// ç”³è¯·ä¸€ä¸ª sizeof (tcache_perthread_struct) å¤§å°çš„ chunk&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;!&lt;/span&gt;victim &lt;span class=&#34;token operator&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ar_ptr &lt;span class=&#34;token operator&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;token constant&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      ar_ptr &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;arena_get_retry&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ar_ptr&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bytes&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      victim &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;_int_malloc&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ar_ptr&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bytes&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ar_ptr &lt;span class=&#34;token operator&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;token constant&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token function&#34;&gt;__libc_lock_unlock&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ar_ptr&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;mutex&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token comment&#34;&gt;/* In a low memory situation, we may not be able to allocate memory&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;     - in which case, we just keep trying later.  However, we&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;     typically do this very early, so either there is sufficient&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;     memory, or there isn&#39;t enough memory to do non-trivial&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;     allocations anyway.  */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;victim&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;// åˆå§‹åŒ– tcache&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      tcache &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache_perthread_struct &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; victim&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token function&#34;&gt;memset&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;sizeof&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache_perthread_struct&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;27&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;code&gt;tcache_init()&lt;/code&gt;  æˆåŠŸè¿”å›åï¼Œ &lt;code&gt;tcache_perthread_struct&lt;/code&gt;  å°±è¢«æˆåŠŸå»ºç«‹äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç”³è¯·å†…å­˜ &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI180&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°†è¿›å…¥ç”³è¯·å†…å­˜çš„æ­¥éª¤&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;// ä» tcache list ä¸­è·å–å†…å­˜&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tc_idx &lt;span class=&#34;token operator&#34;&gt;&amp;lt;&lt;/span&gt; mp_&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tcache_bins &lt;span class=&#34;token comment&#34;&gt;// ç”± size è®¡ç®—çš„ idx åœ¨åˆæ³•èŒƒå›´å†…&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token comment&#34;&gt;/*&amp;amp;&amp;amp; tc_idx &amp;lt; TCACHE_MAX_BINS*/&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;/* to appease gcc */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token operator&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; tcache&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token operator&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;entries&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;token constant&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;// è¯¥æ¡ tcache é“¾ä¸ä¸ºç©º&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;tcache_get&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  DIAG_POP_NEEDS_COMMENT&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token macro property&#34;&gt;&lt;span class=&#34;token directive-hash&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;token directive keyword&#34;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token comment&#34;&gt;// è¿›å…¥ä¸æ—  tcache æ—¶ç±»ä¼¼çš„æµç¨‹&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;SINGLE_THREAD_P&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      victim &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;_int_malloc&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;&amp;amp;&lt;/span&gt;main_arena&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; bytes&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token function&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;!&lt;/span&gt;victim &lt;span class=&#34;token operator&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;chunk_is_mmapped&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;mem2chunk&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;victim&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;||&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;              &lt;span class=&#34;token operator&#34;&gt;&amp;amp;&lt;/span&gt;main_arena &lt;span class=&#34;token operator&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;arena_for_chunk&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token function&#34;&gt;mem2chunk&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;victim&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; victim&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;åœ¨  &lt;code&gt;tcache-&amp;gt;entries&lt;/code&gt;  ä¸ä¸ºç©ºæ—¶ï¼Œå°†è¿›å…¥  &lt;code&gt;tcache_get()&lt;/code&gt;  çš„æµç¨‹è·å– chunkï¼Œå¦åˆ™ä¸ tcache æœºåˆ¶å‰çš„æµç¨‹ç±»ä¼¼ï¼Œè¿™é‡Œä¸»è¦åˆ†æç¬¬ä¸€ç§  &lt;code&gt;tcache_get()&lt;/code&gt; ã€‚è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡º tcache çš„ä¼˜å…ˆçº§å¾ˆé«˜ï¼Œæ¯” fastbin è¿˜è¦é«˜ï¼ˆ fastbin çš„ç”³è¯·åœ¨æ²¡è¿›å…¥ tcache çš„æµç¨‹ä¸­ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;tcache_get()&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI3RjYWNoZV9nZXQ=&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;çœ‹ä¸€ä¸‹  &lt;code&gt;tcache_get()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jb2RlLndvYm9xLm9yZy91c2Vyc3BhY2UvZ2xpYmMvbWFsbG9jL21hbGxvYy5jLmh0bWwjdGNhY2hlX2dldA==&#34;&gt;source code&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;/* Caller must ensure that we know tc_idx is valid and there&#39;s&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;   available chunks to remove.  */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;static&lt;/span&gt; __always_inline &lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;tcache_get&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token class-name&#34;&gt;size_t&lt;/span&gt; tc_idx&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  tcache_entry &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;e &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;entries&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token function&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tc_idx &lt;span class=&#34;token operator&#34;&gt;&amp;lt;&lt;/span&gt; TCACHE_MAX_BINS&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token function&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;entries&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;entries&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; e&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;next&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token operator&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;counts&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;// è·å¾—ä¸€ä¸ª chunkï¼Œcounts å‡ä¸€&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; e&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;code&gt;tcache_get()&lt;/code&gt;  å°±æ˜¯è·å¾— chunk çš„è¿‡ç¨‹äº†ã€‚å¯ä»¥çœ‹å‡ºè¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œä»  &lt;code&gt;tcache-&amp;gt;entries[tc_idx]&lt;/code&gt;  ä¸­è·å¾—ç¬¬ä¸€ä¸ª chunkï¼Œ &lt;code&gt;tcache-&amp;gt;counts&lt;/code&gt;  å‡ä¸€ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;libc_free()&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI19fbGliY19mcmVl&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;çœ‹å®Œç”³è¯·ï¼Œå†çœ‹çœ‹æœ‰ tcache æ—¶çš„é‡Šæ”¾&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jb2RlLndvYm9xLm9yZy91c2Vyc3BhY2UvZ2xpYmMvbWFsbG9jL21hbGxvYy5jLmh0bWwjMzA2OA==&#34;&gt;source code&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;__libc_free&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;mem&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token function&#34;&gt;MAYBE_INIT_TCACHE&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  ar_ptr &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;arena_for_chunk&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;p&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token function&#34;&gt;_int_free&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ar_ptr&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; p&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;code&gt;__libc_free()&lt;/code&gt;  æ²¡æœ‰å¤ªå¤šå˜åŒ–ï¼Œ &lt;code&gt;MAYBE_INIT_TCACHE ()&lt;/code&gt;  åœ¨ tcache ä¸ä¸ºç©ºå¤±å»äº†ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;int_free()&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI19pbnRfZnJlZQ==&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;è·Ÿè¿›  &lt;code&gt;_int_free()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jb2RlLndvYm9xLm9yZy91c2Vyc3BhY2UvZ2xpYmMvbWFsbG9jL21hbGxvYy5jLmh0bWwjNDEyMw==&#34;&gt;source code&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;_int_free&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;mstate av&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; mchunkptr p&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;int&lt;/span&gt; have_lock&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token macro property&#34;&gt;&lt;span class=&#34;token directive-hash&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;token directive keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token expression&#34;&gt;USE_TCACHE&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token class-name&#34;&gt;size_t&lt;/span&gt; tc_idx &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;csize2tidx&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;size&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token keyword&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token operator&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; tc_idx &lt;span class=&#34;token operator&#34;&gt;&amp;lt;&lt;/span&gt; mp_&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tcache_bins &lt;span class=&#34;token comment&#34;&gt;// 64&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token operator&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;counts&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;&amp;lt;&lt;/span&gt; mp_&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;tcache_count&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;// 7&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token function&#34;&gt;tcache_put&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;p&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; tc_idx&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        &lt;span class=&#34;token keyword&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token macro property&#34;&gt;&lt;span class=&#34;token directive-hash&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;token directive keyword&#34;&gt;endif&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;åˆ¤æ–­  &lt;code&gt;tc_idx&lt;/code&gt;  åˆæ³•ï¼Œ &lt;code&gt;tcache-&amp;gt;counts[tc_idx]&lt;/code&gt;  åœ¨ 7 ä¸ªä»¥å†…æ—¶ï¼Œå°±è¿›å…¥  &lt;code&gt;tcache_put()&lt;/code&gt; ï¼Œä¼ é€’çš„ä¸¤ä¸ªå‚æ•°æ˜¯è¦é‡Šæ”¾çš„ chunk å’Œè¯¥ chunk å¯¹åº”çš„ size åœ¨ tcache ä¸­çš„ä¸‹æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;tcache_put()&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUvI3RjYWNoZV9wdXQ=&#34;&gt;Â¶&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jb2RlLndvYm9xLm9yZy91c2Vyc3BhY2UvZ2xpYmMvbWFsbG9jL21hbGxvYy5jLmh0bWwjMjkwNw==&#34;&gt;source code&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight c&#34;&gt;&lt;figcaption data-lang=&#34;c&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token comment&#34;&gt;/* Caller must ensure that we know tc_idx is valid and there&#39;s room&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;   for more chunks.  */&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token keyword&#34;&gt;static&lt;/span&gt; __always_inline &lt;span class=&#34;token keyword&#34;&gt;void&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;tcache_put&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;mchunkptr chunk&lt;span class=&#34;token punctuation&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;token class-name&#34;&gt;size_t&lt;/span&gt; tc_idx&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  tcache_entry &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;e &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache_entry &lt;span class=&#34;token operator&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token function&#34;&gt;chunk2mem&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;chunk&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token function&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tc_idx &lt;span class=&#34;token operator&#34;&gt;&amp;lt;&lt;/span&gt; TCACHE_MAX_BINS&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  e&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;next &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;entries&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;entries&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt; e&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token operator&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;tcache&lt;span class=&#34;token operator&#34;&gt;-&gt;&lt;/span&gt;counts&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;tc_idx&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;code&gt;tcache_puts()&lt;/code&gt;  å®Œæˆäº†æŠŠé‡Šæ”¾çš„ chunk æ’å…¥åˆ°  &lt;code&gt;tcache-&amp;gt;entries[tc_idx]&lt;/code&gt;  é“¾è¡¨å¤´éƒ¨çš„æ“ä½œï¼Œä¹Ÿå‡ ä¹æ²¡æœ‰ä»»ä½•ä¿æŠ¤ã€‚å¹¶ä¸” &lt;strong&gt;æ²¡æœ‰æŠŠ p ä½ç½®é›¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸º CSDN åšä¸»ã€Œè‘£å“¥çš„é»‘æ¿æŠ¥ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ª CC 4.0 BY-SA ç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚&lt;br&gt;
åŸæ–‡é“¾æ¥ï¼š&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1L2FydGljbGUvZGV0YWlscy85Njg2NTMyMQ==&#34;&gt;https://blog.csdn.net/qq_41453285/article/details/96865321&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ctf-wiki:&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9pbXBsZW1lbnRhdGlvbi90Y2FjaGUv&#34;&gt;tcache - CTF Wiki (ctf-wiki.org)&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
 ]]></description>
        </item>
    </channel>
</rss>
